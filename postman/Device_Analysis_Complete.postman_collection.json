{
	"info": {
		"_postman_id": "device-analysis-complete-collection",
		"name": "Device Analysis Complete API",
		"description": "Colección de Postman para el endpoint de análisis completo de dispositivos Ubiquiti.\n\nIncluye:\n- Ping al dispositivo\n- Verificación y habilitación de frecuencias\n- Site survey con filtrado de APs\n- Métricas completas del dispositivo\n- Análisis LLM con recomendaciones",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Analyze Device Complete",
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/v1/analyze-device-complete?ip_address={{device_ip}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"v1",
						"analyze-device-complete"
					],
					"query": [
						{
							"key": "ip_address",
							"value": "{{device_ip}}",
							"description": "IP del dispositivo a analizar (requerido)"
						},
						{
							"key": "ssh_username",
							"value": "ubnt",
							"description": "Usuario SSH (opcional, usa default del config)",
							"disabled": true
						},
						{
							"key": "ssh_password",
							"value": "",
							"description": "Password SSH (opcional, usa default del config)",
							"disabled": true
						}
					]
				},
				"description": "Análisis completo de dispositivo con flujo optimizado:\n\n**Paso 0:** Ping al dispositivo (5 paquetes)\n**Paso 1:** Verificar/habilitar frecuencias vía SSH (237 frecuencias para NanoBeam AC)\n**Paso 2:** Site survey y filtrar mejores APs por BSSID/MAC de UISP\n**Paso 3:** Obtener métricas completas del dispositivo\n**Paso 4:** Análisis LLM con 6 secciones:\n- Conectividad (ping)\n- Estado general (uptime)\n- LAN (ethernet)\n- Wireless/AP (señal, capacidad)\n- APs alternativos\n- Recomendación NOC"
			},
			"response": [
				{
					"name": "Análisis Exitoso - NBE-5AC-19",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/analyze-device-complete?ip_address=100.64.12.94",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"analyze-device-complete"
							],
							"query": [
								{
									"key": "ip_address",
									"value": "100.64.12.94"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"success\": true,\n    \"device\": {\n        \"name\": \"AntonioMarquez\",\n        \"model\": \"NBE-5AC-19\",\n        \"ip\": \"100.64.12.94\"\n    },\n    \"analysis\": {\n        \"llm_summary\": \"1️⃣ CONECTIVIDAD (PING):\\n- Latencia: 88.36 ms → Alta\\n- Pérdida: 0.0% → OK\\n\\n2️⃣ ESTADO GENERAL:\\n- Uptime: 33 días, 9 horas, 27 minutos\\n- Estado: DEGRADADO, debido al alto consumo de tráfico (722.79 GB RX).\\n\\n3️⃣ LAN:\\n- Velocidad: 100 Mbps - Full Duplex\\n- ¿Es un problema? No\\n\\n4️⃣ WIRELESS / AP:\\n- Señal: -40 dBm → Buena\\n- Capacidad: 140.4/126.4 Mbps vs 1 cliente → Suficiente\\n- AP actual adecuado: Sí\\n\\n5️⃣ APS ALTERNATIVOS:\\n- Mejor AP disponible: ubntterranio (-38 dBm, 26 clientes)\\n- No se recomienda cambio, ya que la señal y la carga no justifican el cambio.\\n\\n6️⃣ RECOMENDACIÓN NOC (CLARA Y DIRECTA):\\n- Mantener AP actual (óptimo).\\n- Monitorear el alto consumo de tráfico y investigar posibles causas.\",\n        \"ping\": {\n            \"reachable\": true,\n            \"packets_sent\": 5,\n            \"packets_received\": 5,\n            \"packet_loss\": 0.0,\n            \"avg_latency_ms\": 88.36\n        },\n        \"metrics\": {\n            \"device_name\": \"AntonioMarquez\",\n            \"device_model\": \"NBE-5AC-19\",\n            \"signal\": {\n                \"current\": -40,\n                \"max\": -47,\n                \"remote_max\": -47\n            },\n            \"cpu\": 4,\n            \"ram\": 34,\n            \"uptime\": {\n                \"seconds\": 2885226,\n                \"days\": 33,\n                \"hours\": 9,\n                \"minutes\": 27,\n                \"formatted\": \"33 días, 9 horas, 27 minutos\"\n            },\n            \"ethernet\": {\n                \"speed\": \"100 Mbps - Full Duplex\",\n                \"plugged\": false,\n                \"connected\": false\n            },\n            \"wireless\": {\n                \"frequency\": 5670,\n                \"channel_width\": 20,\n                \"transmit_power\": 26,\n                \"antenna_gain\": 19,\n                \"eirp\": null,\n                \"uplink_mbps\": 126.4,\n                \"downlink_mbps\": 140.4\n            },\n            \"traffic\": {\n                \"rx_gb\": 722.79,\n                \"tx_gb\": 49.81\n            },\n            \"link_quality\": {\n                \"score\": 0.874,\n                \"uplink_score\": 0.77,\n                \"downlink_score\": 0.95,\n                \"airtime\": 0.007\n            },\n            \"current_ap\": {\n                \"name\": \"AntonioMarquez\",\n                \"clients\": 1\n            }\n        },\n        \"frequency_check\": {\n            \"success\": true,\n            \"action\": \"configured\",\n            \"message\": \"✅ NBE-5AC-19 configurado con todas las 237 frecuencias disponibles.\",\n            \"device_model\": \"NBE-5AC-19\",\n            \"frequencies_before\": 146,\n            \"frequencies_after\": 237,\n            \"frequencies_added\": 91,\n            \"frequency_range\": \"4920-6100\"\n        },\n        \"site_survey\": {\n            \"success\": true,\n            \"aps_found\": 1,\n            \"aps_filtered\": 1,\n            \"best_ap\": {\n                \"bssid\": \"E0:63:DA:60:51:C1\",\n                \"ssid\": \"ubntterranio\",\n                \"mode\": \"Master\",\n                \"frequency_ghz\": 5.67,\n                \"frequency_mhz\": 5670,\n                \"signal_dbm\": -38,\n                \"quality\": 58,\n                \"quality_max\": 94,\n                \"quality_percent\": 61,\n                \"encrypted\": true,\n                \"ap_name\": \"Hipico PanelAC Dir. Terranio\",\n                \"clients_connected\": 26\n            },\n            \"second_best_ap\": null\n        }\n    }\n}"
				},
				{
					"name": "Análisis Exitoso - LBE-5AC-Gen2",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/analyze-device-complete?ip_address=100.64.11.83",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"analyze-device-complete"
							],
							"query": [
								{
									"key": "ip_address",
									"value": "100.64.11.83"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"success\": true,\n    \"device\": {\n        \"name\": \"Andy\",\n        \"model\": \"LBE-5AC-Gen2\",\n        \"ip\": \"100.64.11.83\"\n    },\n    \"analysis\": {\n        \"llm_summary\": \"1️⃣ CONECTIVIDAD (PING):\\n- Latencia: 2.5 ms → Buena\\n- Pérdida: 0% → OK\\n\\n2️⃣ ESTADO GENERAL:\\n- Uptime: 5 días, 12 horas, 30 minutos\\n- Estado: OK\\n\\n3️⃣ LAN:\\n- Velocidad: 1 Gbps - Full Duplex\\n- ¿Es un problema? No\\n\\n4️⃣ WIRELESS / AP:\\n- Señal: -52 dBm → Buena\\n- Capacidad: 117.0/117.0 Mbps vs 22 clientes → Suficiente\\n- AP actual adecuado: Sí\\n\\n5️⃣ APS ALTERNATIVOS:\\n- Mejor AP: Hipico Panel Dir. Garcia (-47 dBm, 30 clientes)\\n- Mejora de señal: +5 dBm\\n- No se recomienda cambio (más clientes en AP alternativo)\\n\\n6️⃣ RECOMENDACIÓN NOC:\\n- Mantener AP actual (óptimo)\\n- Solo monitorear\",\n        \"ping\": {\n            \"reachable\": true,\n            \"packets_sent\": 5,\n            \"packets_received\": 5,\n            \"packet_loss\": 0.0,\n            \"avg_latency_ms\": 2.5\n        },\n        \"frequency_check\": {\n            \"success\": true,\n            \"action\": \"skipped\",\n            \"message\": \"✅ LBE-5AC-Gen2 ya tiene todas las 237 frecuencias configuradas.\",\n            \"reason\": \"already_configured\"\n        }\n    }\n}"
				},
				{
					"name": "Error - Dispositivo No Encontrado",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/analyze-device-complete?ip_address=192.168.1.999",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"analyze-device-complete"
							],
							"query": [
								{
									"key": "ip_address",
									"value": "192.168.1.999"
								}
							]
						}
					},
					"status": "Not Found",
					"code": 404,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"detail\": \"Dispositivo 192.168.1.999 no encontrado en UISP\"\n}"
				}
			]
		},
		{
			"name": "Device Metrics (Solo Métricas)",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/v1/device-metrics?ip_address={{device_ip}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"v1",
						"device-metrics"
					],
					"query": [
						{
							"key": "ip_address",
							"value": "{{device_ip}}",
							"description": "IP del dispositivo"
						}
					]
				},
				"description": "Obtiene solo las métricas del dispositivo sin análisis LLM ni site survey.\n\nÚtil para obtener datos estructurados rápidamente."
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "device_ip",
			"value": "100.64.12.94",
			"type": "string"
		}
	]
}
